# Используем фиксированную версию, чтобы не было проблем с legasy в дальнейшем
FROM node:20

# Создаём рабочую директорию
WORKDIR /app

# Копируем файлы с необходимыми пакетами
COPY package*.json ./

# Устанавливаем зависимости.
# Используем ci, чтобы не было проблем с различиями между версиями у разработчика и у сервера
RUN npm ci

# Копируем все остальные файлы
COPY . .

# Компилируем Prisma
RUN npx prisma generate

# Компилируем всё остальное
RUN npm run build

# Запускаем
CMD [ "node", "dist/main.js" ]
